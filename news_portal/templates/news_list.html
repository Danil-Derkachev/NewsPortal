{% extends 'flatpages/default.html' %}

{% load custom_filters %}
{% load custom_tags %}

{% block title %}
Новости
{% endblock title %}

{% block content %}
<!--Информация пользователя-->
<h2>Авторизован как {{request.user.username}}</h2>
<div> Здесь может содержаться персональная информация для каждого пользователя</div>
<button><a href="sign/logout/">Выйти</a></button>

<!--Кнопки для создания новостей-->
{% if is_not_author %}
<button><a href="sign/upgrade/"> Стать автором </a></button>
{% else %}
<button><a href="news/create/"> Написать новость </a></button>
<button><a href="article/create/"> Написать статью </a></button>
{% endif %}

<!--Количество новостей на сайте-->
<table>
    <tbody>
    <tr>
        <td>Всего новостей:</td>
        <td><em>{{ all_news|length }}</em></td>
    </tr>
    </tbody>
</table>

<!--Поиск по фильтру-->
<h3>Поиск по фильтру</h3>
<form action="" method="get">
    {{ filterset.form.as_p }}
    <input type="submit" value="Найти"/>
</form>

<!--Подписка на отдельные категории-->
<div class="col-md-4">
    <h3>Категории</h3>
    <ul>
        {% for category in categories %}    <!-- categories обозначена в get_context_data!!! -->
        <li>
            <a href="{{ category.name }}">{{ category.name }}</a>
            <form action="{% url 'news_subscribe' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="category" value="{{ category.name }}">
                <input type="submit" value="Подписаться">
            </form>
        </li>
        {% endfor %}
    </ul>
</div>

<!--Таблица всех новостей-->
<h1>Актуальные новости</h1>
<hr>
{% if news_list %}
{% for n in news_list %}
<header>
    <section>
        <h5><a href="{{ n.get_absolute_url }}">{{ n.title }}</a></h5>
    </section>
</header>
<main>
    <section>
            {{ n.text|censor|shorten }}
    </section>
</main>
<footer>
    <section>
        Рейтинг новости {{ n.rating }} | Автор {{ n.author }} | Рейтинг автора {{ n.author.rating }} |
        Дата публикации {{ n.datetime|date:'d.m.Y' }}
    </section>
</footer>
<hr>
{% endfor %}
{% else %}
<h2>Новостей нет</h2>
{% endif %}

<!--Пагинация-->
{% if page_obj.has_previous %}
{# Для каждой ссылки пагинации указываем обработку через тег url_replace #}
<a href="?{% url_replace page=1 %}">1</a>
{% if page_obj.previous_page_number != 1 %}
...
<a href="?{% url_replace page=page_obj.previous_page_number %}">{{ page_obj.previous_page_number }}</a>
{% endif %}
{% endif %}
{{ page_obj.number }}
{% if page_obj.has_next %}
<a href="?{% url_replace page=page_obj.next_page_number %}">{{ page_obj.next_page_number }}</a>
{% if paginator.num_pages != page_obj.next_page_number %}
...
<a href="?{% url_replace page=page_obj.paginator.num_pages %}">{{ page_obj.paginator.num_pages }}</a>
{% endif %}
{% endif %}

{% endblock content %}
